# DV_example_minimal – Мини-проект «DevOps-конвейер» (пример «минимум на 1»)

> Пример для ориентира: как может выглядеть заполненный DV на базовый уровень.  
> Проект вымышленный, домен упрощён.

---

## 0) Мета

- **Проект (опционально BYO):** Учебный сервис онлайн-заказа еды «FoodGo» (учебный шаблон)
- **Версия (commit/date):** abc123 / 2025-11-22
- **Кратко (1-2 предложения):**  
  Простое Python-веб-приложение (FastAPI/Flask), в котором есть API для создания и просмотра заказов.  
  В DV мы настраиваем локальный запуск тестов, Docker-образ и базовый CI.

---

## 1) Воспроизводимость локальной сборки и тестов (DV1)

**Одна команда (последовательность) для сборки/тестов:**

```bash
# из корня репозитория
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pytest -q
```

*Этой последовательности достаточно, чтобы собрать окружение и прогнать тесты.*

**Описание шагов (кратко):**

1. Клонировать репозиторий и перейти в его директорию.
2. Создать виртуальное окружение и активировать его.
3. Установить зависимости `pip install -r requirements.txt`.
4. Запустить тесты командой `pytest -q`.
5. Убедиться, что все тесты зелёные.

**Фиксация версии Python (минимально):**

```bash
python --version  # вывод переношу в EVIDENCE/dv-python-version.txt
```

*Вывод сохранён в `EVIDENCE/dv-python-version.txt`.*

---

## 2) Контейнеризация (DV2)

**Dockerfile:** `Dockerfile` в корне репозитория.

**Сборка/запуск локально:**

```bash
# сборка образа
docker build -t foodgo-app:local .

# запуск контейнера
docker run --rm -p 8080:8080 foodgo-app:local
```

- Приложение внутри контейнера слушает порт `8080`.
- Команда запуска внутри Dockerfile: `uvicorn app.main:app --host 0.0.0.0 --port 8080`.
- Для базового уровня healthcheck не настраивал – достаточно, что контейнер поднимается и API отвечает.

  *(docker-compose на этом уровне не используем, чтобы остаться в рамках «минимум на 1».)*

---

## 3) CI: базовый pipeline и стабильный прогон (DV3)

**Платформа CI:** GitHub Actions.
**Файл конфига CI:** `.github/workflows/ci.yml`.

**Структура job (build + test):**

```yaml
name: CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build_test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          pip install -r requirements.txt

      - name: Run tests
        run: |
          pytest -q
```

- Минимальный pipeline: `checkout → setup-python → install deps → pytest`.
- Все последние прогоны по ветке `main` зелёные (3/3 успешных запусков подряд).

**Ссылка/копия лога прогона:**

- Лог одного успешного прогона сохранён в `EVIDENCE/ci-2025-11-21-build.txt`.

---

## 4) Артефакты и логи конвейера (DV4)

Все файлы сложены в `EVIDENCE/` индивидуального репозитория студента.

| Артефакт/лог                | Путь в `EVIDENCE/`                 | Комментарий                                              |
| --------------------------- | ---------------------------------- | -------------------------------------------------------- |
| Лог успешного CI-прогона    | `EVIDENCE/ci-2025-11-21-build.txt` | полный лог job `build_test` с GitHub Actions             |
| Локальный лог сборки Docker | `EVIDENCE/local-docker-build.txt`  | вывод `docker build -t foodgo-app:local .`               |
| Описание результата сборки  | `EVIDENCE/package-notes.txt`       | что собираем: Docker-образ `foodgo-app:local`, порт 8080 |
| Версия Python локально      | `EVIDENCE/dv-python-version.txt`   | вывод `python --version`                                 |

*Этого набора достаточно, чтобы преподаватель мог понять, что именно и как собирается и запускается.*

---

## 5) Секреты и переменные окружения (DV5 – гигиена, без сканеров)

**Шаблон окружения:** в корне репозитория создан файл `.env.example` со списком переменных:

```env
# .env.example
FOODGO_DB_URL=
FOODGO_API_KEY=
FOODGO_LOG_LEVEL=INFO
```

- В `.env.example` **нет реальных значений**, только имена переменных.
- Реальный `.env` **не коммитится**, добавлен в `.gitignore`.

**Хранение и использование секретов в CI:**

- Секреты (`FOODGO_DB_URL`, `FOODGO_API_KEY`) заведены в настройках репозитория GitHub как `secrets.FOODGO_DB_URL`, `secrets.FOODGO_API_KEY`.
- В pipeline они используются только через переменные окружения и не выводятся в лог.

Пример фрагмента job (без лишних трюков, уровень «1»):

```yaml
  - name: Run tests with env
    env:
      FOODGO_DB_URL: ${{ secrets.FOODGO_DB_URL }}
      FOODGO_API_KEY: ${{ secrets.FOODGO_API_KEY }}
    run: |
      pytest -q
```

- В логах нет значений секретов – только факт запуска тестов.
- В README есть короткий комментарий, что свои значения студент задаёт локально в `.env`, а в CI – через Secrets.

*(Дополнительные проверки типа `git grep` на секреты и add-mask не добавлял, чтобы не уезжать в уровень «2» по рубрике.)*

---

## 6) Индекс артефактов DV

Для быстрого сопоставления с репортом и рубрикой:

| Тип     | Файл в `EVIDENCE/`        | Дата/время       | Коммит/версия | Runner/OS    |
| ------- | ------------------------- | ---------------- | ------------- | ------------ |
| CI-лог  | `ci-2025-11-21-build.txt` | 2025-11-21 19:42 | `abc123`      | `gha-ubuntu` |
| Лок.лог | `local-docker-build.txt`  | 2025-11-21 19:30 | `abc123`      | `local`      |
| Package | `package-notes.txt`       | 2025-11-21 19:31 | `abc123`      | –            |
| Version | `dv-python-version.txt`   | 2025-11-21 19:25 | `abc123`      | `local`      |

---

## 7) Связь с TM и DS (hook)

- **TM:** этот конвейер помогает закрывать риски по воспроизводимости и контролю сборки/поставки (часть рисков из TM по supply chain).
- **DS:** в дальнейшем на этот же pipeline можно будет навесить сканы (SAST/SCA/DAST) и гейты, а отчёты и триаж уже пойдут в `DS.md`.

---

## 8) Самооценка по рубрике DV (0/1/2)

> Пример оценки для этого файла (как базового):

- **DV1. Воспроизводимость локальной сборки и тестов:** [ ] 0 [x] 1 [ ] 2
- **DV2. Контейнеризация (Docker/Compose):** [ ] 0 [x] 1 [ ] 2
- **DV3. CI: базовый pipeline и стабильный прогон:** [ ] 0 [x] 1 [ ] 2
- **DV4. Артефакты и логи конвейера:** [ ] 0 [x] 1 [ ] 2
- **DV5. Секреты и конфигурация окружения (гигиена):** [ ] 0 [x] 1 [ ] 2

**Итог DV (сумма, пример):** 5/10
